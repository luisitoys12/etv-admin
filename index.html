<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    <!-- Contenido existente -->

    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, collection, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

// Configuración de tu proyecto Firebase (REEMPLAZA con tus datos reales)
const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_AUTH_DOMAIN",
  projectId: "TU_PROJECT_ID",
  // ...el resto de tu config...
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// --- PROGRAMACIÓN DINÁMICA ---
let programmingData = [];
function renderSlidesDynamic(dayFilter = 'Todos') {
  const slidesContainer = document.querySelector('.slides-standalone');
  const dotContainer = document.querySelector('.dot-container-standalone');
  slidesContainer.innerHTML = '';
  dotContainer.innerHTML = '';
  const filteredData = dayFilter === 'Todos' ? programmingData : programmingData.filter(p => p.day === dayFilter);

  if (filteredData.length === 0) {
    slidesContainer.innerHTML = '<div class="mySlides-standalone" style="display: block;"><p>No hay programas disponibles para este día.</p></div>';
    return;
  }

  filteredData.forEach((program, index) => {
    const slide = document.createElement('div');
    slide.classList.add('mySlides-standalone');
    slide.style.display = 'none';
    slide.innerHTML = `
      <img src="${program.image}" alt="${program.title}">
      <h3>${program.title}</h3>
      <p><strong>Día:</strong> ${program.day}</p>
      <p><strong>Hora:</strong> ${program.time}</p>
      <p>${program.description}</p>
    `;
    slidesContainer.appendChild(slide);

    const dot = document.createElement('span');
    dot.classList.add('dot-standalone');
    dot.onclick = () => currentSlideDynamic(index + 1);
    dotContainer.appendChild(dot);
  });

  slideIndexDynamic = 0;
  showSlidesDynamic(slideIndexDynamic);
}
let slideIndexDynamic = 0;
let slideshowTimeoutDynamic;
function showSlidesDynamic(n) {
  const slides = document.querySelectorAll('.mySlides-standalone');
  const dots = document.querySelectorAll('.dot-standalone');
  if (slides.length === 0) return;
  if (n >= slides.length) slideIndexDynamic = 0;
  if (n < 0) slideIndexDynamic = slides.length - 1;
  slides.forEach(slide => slide.style.display = 'none');
  dots.forEach(dot => dot.classList.remove('active-dot-standalone'));
  slides[slideIndexDynamic].style.display = 'block';
  if (dots[slideIndexDynamic]) dots[slideIndexDynamic].classList.add('active-dot-standalone');
  clearTimeout(slideshowTimeoutDynamic);
  slideshowTimeoutDynamic = setTimeout(() => plusSlidesDynamic(1), 5000);
}
function plusSlidesDynamic(n) { showSlidesDynamic(slideIndexDynamic += n); }
function currentSlideDynamic(n) { showSlidesDynamic(slideIndexDynamic = n - 1); }
function setDayFilterDynamic(day) {
  document.querySelectorAll('.day-button-standalone').forEach(button => {
    button.classList.remove('active');
    if (button.dataset.day === day) button.classList.add('active');
  });
  renderSlidesDynamic(day);
}
document.querySelectorAll('.day-button-standalone').forEach(button => {
  button.addEventListener('click', () => setDayFilterDynamic(button.dataset.day));
});
onSnapshot(collection(db, "programacion"), (snapshot) => {
  programmingData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  setDayFilterDynamic('Todos');
});

// --- TOP 10 (imagen y playlist dinámicas) ---
function renderTop10(data) {
  const img = document.querySelector('.top10-image-container-standalone img');
  if (img && data.image) img.src = data.image;
  window.top10PlaylistId = data.playlistId || '';
}
onSnapshot(doc(db, "top10", "config"), (docSnap) => {
  if (docSnap.exists()) renderTop10(docSnap.data());
});
document.getElementById('openTop10Modal').onclick = function() {
  document.getElementById('top10ModalStandalone').style.display = 'flex';
  const container = document.querySelector('.youtube-playlist-container-standalone');
  container.innerHTML = '';
  if (window.top10PlaylistId) {
    const iframe = document.createElement('iframe');
    iframe.src = `https://www.youtube.com/embed/videoseries?list=${window.top10PlaylistId}`;
    iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
    iframe.allowFullscreen = true;
    iframe.style.width = "100%";
    iframe.style.height = "340px";
    container.appendChild(iframe);
  }
};
document.getElementById('closeTop10Modal').onclick = function() {
  document.getElementById('top10ModalStandalone').style.display = 'none';
};

// --- MENSAJE EN VIVO ---
onSnapshot(doc(db, "mensajes", "liveMessage"), (docSnap) => {
  if (docSnap.exists()) {
    let liveMessage = docSnap.data().text || '';
    let liveMsgDiv = document.getElementById('live-message');
    if (!liveMsgDiv) {
      liveMsgDiv = document.createElement('div');
      liveMsgDiv.id = 'live-message';
      liveMsgDiv.style = "background:#ffc107;padding:10px 0;color:#222;text-align:center;font-size:1.3em;font-weight:bold;margin-top:10px;";
      document.body.prepend(liveMsgDiv);
    }
    liveMsgDiv.textContent = liveMessage;
  }
});

// --- ENCUESTA EN VIVO ---
onSnapshot(doc(db, "encuestas", "currentPoll"), (docSnap) => {
  if (docSnap.exists()) {
    const data = docSnap.data();
    let pollDiv = document.getElementById('live-poll');
    if (!pollDiv) {
      pollDiv = document.createElement('div');
      pollDiv.id = 'live-poll';
      pollDiv.style = "background:#e9ecef;padding:20px;border-radius:12px;max-width:500px;margin:30px auto;text-align:center;";
      document.body.insertBefore(pollDiv, document.body.firstChild.nextSibling);
    }
    pollDiv.innerHTML = `<h3 style="font-size:1.3em;color:#007bff;margin-bottom:10px;">${data.question}</h3>
      ${data.options.map((opt, i) => `<div style="margin:8px 0;">${opt.text}</div>`).join("")}`;
  }
});
</script>
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - EstacionKuSTV</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f7f9fc;
        }
        .container {
            margin-top: 50px;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: none;
            border-radius: 12px;
        }
        h2 {
            color: #007bff;
        }
        .form-control, .btn {
            border-radius: 50px;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
            border-radius: 12px;
        }
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
            border-radius: 12px;
        }
        #login-section {
            max-width: 400px;
            margin: auto;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container" id="login-section">
    <h2>Login de Administrador</h2>
    <div class="card p-4">
        <div class="form-group">
            <input type="password" class="form-control" id="admin-password" placeholder="Ingresa tu contraseña">
        </div>
        <button class="btn btn-primary btn-lg" id="login-btn">Entrar</button>
        <div id="login-status" class="mt-3"></div>
    </div>
</div>

<div class="container" id="admin-panel" style="display:none;">
    <h1 class="text-center mb-4">Panel de Administración de EstacionKuSTV</h1>
    <p class="text-right"><button class="btn btn-secondary" id="logout-btn">Cerrar Sesión</button></p>

    <div class="card p-4">
        <h2>Programación</h2>
        <form id="program-form">
            <div class="form-group">
                <label for="program-day">Día</label>
                <select class="form-control" id="program-day">
                    <option value="Lunes">Lunes</option>
                    <option value="Martes">Martes</option>
                    <option value="Miercoles">Miércoles</option>
                    <option value="Jueves">Jueves</option>
                    <option value="Viernes">Viernes</option>
                    <option value="Sabado">Sábado</option>
                    <option value="Domingo">Domingo</option>
                </select>
            </div>
            <div class="form-group">
                <label for="program-title">Título</label>
                <input type="text" class="form-control" id="program-title" required>
            </div>
            <div class="form-group">
                <label for="program-time">Horario</label>
                <input type="text" class="form-control" id="program-time" placeholder="Ej: 08:00 AM - 09:00 AM" required>
            </div>
            <div class="form-group">
                <label for="program-description">Descripción</label>
                <textarea class="form-control" id="program-description" rows="3" required></textarea>
            </div>
            <div class="form-group">
                <label for="program-image">URL de la Imagen</label>
                <input type="url" class="form-control" id="program-image" required>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Agregar Programa</button>
        </form>
        <hr>
        <ul id="program-list" class="list-group"></ul>
    </div>

    <div class="card p-4">
        <h2>Top 10 Musical</h2>
        <form id="top10-form">
            <div class="form-group">
                <label for="top10-image">URL de la Imagen del Top 10</label>
                <input type="url" class="form-control" id="top10-image" required>
            </div>
            <div class="form-group">
                <label for="top10-playlist-id">ID de la Playlist de YouTube</label>
                <input type="text" class="form-control" id="top10-playlist-id" placeholder="Ej: PL0Tz1eP0c26D6-r_t2r7x-9J3b2r_7K9o" required>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Actualizar Top 10</button>
        </form>
    </div>

    <div class="card p-4">
        <h2>Gestión de Encuestas</h2>
        <form id="poll-form">
            <div class="form-group">
                <label for="poll-question">Pregunta de la Encuesta</label>
                <input type="text" class="form-control" id="poll-question" required>
            </div>
            <div class="form-group">
                <label>Opciones (separadas por coma)</label>
                <input type="text" class="form-control" id="poll-options" placeholder="Opción A, Opción B, Opción C" required>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Crear Nueva Encuesta</button>
        </form>
        <hr>
        <h3>Encuesta Actual</h3>
        <div id="current-poll-display">Cargando encuesta...</div>
        <button class="btn btn-danger btn-sm mt-3" id="reset-poll-btn">Resetear Encuesta</button>
    </div>

    <div class="card p-4">
        <h2>Mensajes en Vivo</h2>
        <form id="live-message-form">
            <div class="form-group">
                <label for="live-message">Escribe un mensaje para la audiencia:</label>
                <input type="text" class="form-control" id="live-message" placeholder="Ej: ¡Pronto regresamos con más música!">
            </div>
            <button type="submit" class="btn btn-primary mt-3">Enviar Mensaje</button>
        </form>
    </div>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script>
    // ** 1. IMPORTANTE: PEGA AQUÍ TU CONFIGURACIÓN DE FIREBASE **
    // Ve a la consola de Firebase > Configuración del proyecto > Tus apps > Web
    const firebaseConfig = {
        apiKey: "TU_API_KEY",
        authDomain: "TU_AUTH_DOMAIN",
        projectId: "TU_PROJECT_ID",
        storageBucket: "TU_STORAGE_BUCKET",
        messagingSenderId: "TU_MESSAGING_SENDER_ID",
        appId: "TU_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ** 2. IMPORTANTE: DEFINE AQUÍ TU CONTRASEÑA SECRETA **
    const ADMIN_PASSWORD = "TU_CONTRASEÑA_SECRETA_AQUI"; 

    // Referencias a elementos del DOM
    const loginSection = document.getElementById('login-section');
    const adminPanel = document.getElementById('admin-panel');
    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const adminPasswordInput = document.getElementById('admin-password');
    const loginStatus = document.getElementById('login-status');
    const programForm = document.getElementById('program-form');
    const programList = document.getElementById('program-list');
    const top10Form = document.getElementById('top10-form');
    const pollForm = document.getElementById('poll-form');
    const currentPollDisplay = document.getElementById('current-poll-display');
    const resetPollBtn = document.getElementById('reset-poll-btn');
    const liveMessageForm = document.getElementById('live-message-form');

    let isAuthenticated = false;

    // --- Funciones de Autenticación ---
    loginBtn.addEventListener('click', () => {
        if (adminPasswordInput.value === ADMIN_PASSWORD) {
            isAuthenticated = true;
            loginSection.style.display = 'none';
            adminPanel.style.display = 'block';
            loadPrograms();
            loadCurrentPoll();
            loginStatus.innerHTML = '';
        } else {
            loginStatus.innerHTML = '<div class="alert alert-danger">Contraseña incorrecta.</div>';
        }
    });

    logoutBtn.addEventListener('click', () => {
        isAuthenticated = false;
        loginSection.style.display = 'block';
        adminPanel.style.display = 'none';
        adminPasswordInput.value = '';
    });

    // --- Funciones de Programación ---
    programForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const newProgram = {
            day: document.getElementById('program-day').value,
            title: document.getElementById('program-title').value,
            time: document.getElementById('program-time').value,
            description: document.getElementById('program-description').value,
            image: document.getElementById('program-image').value
        };
        db.collection('programacion').add(newProgram).then(() => {
            alert('Programa agregado con éxito.');
            programForm.reset();
            loadPrograms(); // Recarga la lista para ver el nuevo programa
        }).catch(error => {
            console.error("Error al agregar programa: ", error);
        });
    });

    function loadPrograms() {
        programList.innerHTML = '';
        db.collection('programacion').orderBy('day').get().then(snapshot => {
            snapshot.forEach(doc => {
                const program = doc.data();
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';
                li.innerHTML = `
                    <div>
                        <strong>${program.day} - ${program.title}</strong><br>
                        <small>${program.time}</small>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="deleteProgram('${doc.id}')">Eliminar</button>
                `;
                programList.appendChild(li);
            });
        });
    }

    function deleteProgram(id) {
        if (confirm('¿Estás seguro de que quieres eliminar este programa?')) {
            db.collection('programacion').doc(id).delete().then(() => {
                alert('Programa eliminado.');
                loadPrograms();
            }).catch(error => {
                console.error("Error al eliminar programa: ", error);
            });
        }
    }

    // --- Funciones de Top 10 Musical ---
    top10Form.addEventListener('submit', (e) => {
        e.preventDefault();
        const top10Data = {
            image: document.getElementById('top10-image').value,
            playlistId: document.getElementById('top10-playlist-id').value
        };
        db.collection('top10').doc('config').set(top10Data).then(() => {
            alert('Top 10 actualizado.');
        }).catch(error => {
            console.error("Error al actualizar Top 10: ", error);
        });
    });

    // --- Funciones de Encuestas ---
    pollForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const question = document.getElementById('poll-question').value;
        const optionsText = document.getElementById('poll-options').value;
        const optionsArray = optionsText.split(',').map(item => item.trim());
        
        const newPoll = {
            question: question,
            options: optionsArray,
            votes: optionsArray.map(() => 0)
        };
        db.collection('encuestas').doc('currentPoll').set(newPoll).then(() => {
            alert('Nueva encuesta creada.');
            loadCurrentPoll();
            pollForm.reset();
        }).catch(error => {
            console.error("Error al crear encuesta: ", error);
        });
    });

    function loadCurrentPoll() {
        db.collection('encuestas').doc('currentPoll').get().then(doc => {
            if (doc.exists) {
                const poll = doc.data();
                let resultsHtml = `<h4>${poll.question}</h4>`;
                poll.options.forEach((option, index) => {
                    resultsHtml += `<p>${option}: ${poll.votes[index]} votos</p>`;
                });
                currentPollDisplay.innerHTML = resultsHtml;
            } else {
                currentPollDisplay.innerHTML = '<p>No hay una encuesta activa.</p>';
            }
        });
    }

    resetPollBtn.addEventListener('click', () => {
        if (confirm('¿Estás seguro de que quieres resetear la encuesta actual?')) {
            db.collection('encuestas').doc('currentPoll').delete().then(() => {
                alert('Encuesta reseteada.');
                loadCurrentPoll();
            }).catch(error => {
                console.error("Error al resetear la encuesta: ", error);
            });
        }
    });

    // --- Funciones de Mensajes en Vivo ---
    liveMessageForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const message = document.getElementById('live-message').value;
        db.collection('mensajes').doc('liveMessage').set({ text: message, timestamp: firebase.firestore.FieldValue.serverTimestamp() }).then(() => {
            alert('Mensaje en vivo enviado.');
            liveMessageForm.reset();
        }).catch(error => {
            console.error("Error al enviar mensaje: ", error);
        });
    });
</script>
</body>
</html>
